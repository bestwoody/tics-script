#!/bin/bash

# TODO: remote 'sleep' after FLASH-635 is addressed
function cmd_ti_ci_release()
{
	local file="${1}"
	shift 6
	local ti="${integrated}/ops/ti.sh"

	# TODO: testing
	"${ti}" "${file}" repeat 20 'store/rm:up'

	"${ti}" "${file}" repeat 20 'tpch/load 0.001 all:sleep 5:tpch/ch:tpch/tikv'

	"${ti}" "${file}" repeat 20 'kill/storage:up:sleep 5:tpch/ch:tpch/tikv'

	# TODO: recover time is unstable
	#"${ti}" "${file}" repeat 20 'kill/random:kill/random:up'
}

set -euo pipefail
cmd_ti_ci_release "${@}"
